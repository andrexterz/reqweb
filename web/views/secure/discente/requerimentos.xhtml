<ui:composition template="discente.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core">
    <ui:define name="componentTitle">#{requerimentoBean.tipoRequerimento != null ? requerimentoBean.tipoRequerimento.tipoLocale: msg.requerimentos}</ui:define>
    <ui:define name="content">
        <script>
            $(document).ready(function() {
                var widgetId = ["#discenteMenuLinks\\:", "#{requerimentoBean.tipoRequerimento != null ? requerimentoBean.tipoRequerimento.tipo: 'requerimentos'}", "Lnk"].join("");
                $(widgetId).addClass("menuItemSelected");
                console.log(widgetId);
            });
        </script>
        <ui:include src="salvaRequerimentoForm.xhtml" />
        <ui:include src="excluiRequerimentoForm.xhtml" />
        <ui:include src="detalheRequerimentoForm.xhtml" />
        <h:form id="requerimentoForm" styleClass="formBody">
            <h:panelGroup layout="block" id="requerimentoToolbar" styleClass="formToolbar">
                <p:commandButton value="#{msg.novo}"
                                 process="@this"
                                 disabled="#{requerimentoBean.tipoRequerimento == null}"
                                 action="#{requerimentoBean.novoRequerimento}"
                                 oncomplete="PF('dlgRequerimentoVar').show()"                                 
                                 update="tableRequerimentos :dlgRequerimentoForm :salvaRequerimentoForm" />
                <p:commandButton value="#{msg.editar}"
                                 process="@this"
                                 disabled="#{requerimentoBean.selecionado == false}"
                                 actionListener="#{requerimentoBean.editaRequerimento}"
                                 oncomplete="PF('dlgRequerimentoVar').show()"                                 
                                 update="tableRequerimentos :salvaRequerimentoForm" />

                <p:commandButton value="#{msg.excluir}"
                                 disabled="#{requerimentoBean.selecionado== false}"
                                 oncomplete="excluirRequerimentoDialog.show()"
                                 update=":excluiRequerimentoForm" />

                <p:commandButton value="#{msg.atendimento}"
                                 disabled="#{requerimentoBean.selecionado== false}"
                                 oncomplete="detalheRequerimentoDialog.show()"
                                 actionListener="#{requerimentoBean.findAtendimentos}"
                                 update=":dlgDetalheRequerimentoDialog" />

                <h:panelGroup id="searchPanel" layout="block" styleClass="searchBoxWrapper">
                    <h:outputLabel for="searchType" value="#{msg.buscar}" />
                    <p:selectOneButton styleClass="searchBoxMenu"
                                       id="searchType"
                                       value="#{requerimentoBean.tipoBusca}">
                        <f:selectItems value="#{requerimentoBean.tipoBuscaEnum.entrySet()}"
                                       var="tipoBuscaItem"
                                       itemLabel="#{tipoBuscaItem.key}"
                                       itemValue="#{tipoBuscaItem.value}"/>
                        <p:ajax update="searchPanel tableRequerimentos" />
                    </p:selectOneButton>
                    <p:autoComplete id="requerimentoTipoRequerimento"
                                    completeMethod="#{requerimentoBean.findTipoRequerimento}"
                                    value="#{requerimentoBean.tipoRequerimentoBusca}"
                                    disabled="#{requerimentoBean.tipoRequerimento != null}"
                                    minQueryLength="4"
                                    forceSelection="true"
                                    styleClass="searchBoxAutocomplete"
                                    converter="#{tipoRequerimentoEnumConverter}"
                                    var="tipoReqItem"
                                    itemLabel="#{tipoReqItem.tipoLocale}"
                                    itemValue="#{tipoReqItem}"
                                    rendered="#{requerimentoBean.tipoBusca == 'TIPO_REQUERIMENTO'}">
                        <p:ajax event="itemSelect" listener="#{requerimentoBean.autoCompleteSelecionaTipoBuscaRequerimento}" />
                    </p:autoComplete>
                    <p:watermark for="requerimentoTipoRequerimento" value="#{msg.requerimento}" />
                    <p:inputMask id="requerimentoBuscaPeriodo"
                                 value="#{requerimentoBean.termoBuscaPeriodo}"
                                 mask="99/99/9999 - 99/99/9999"
                                 styleClass="searchBox"
                                 rendered="#{requerimentoBean.tipoBusca == 'DATA_PERIODO'}" />
                    <p:watermark for="requerimentoBuscaPeriodo" value="#{msg.periodo}" />
                    <p:inputText id="requerimentoBuscaDiscente"
                                 styleClass="searchBox"
                                 disabled="#{usuarioBean.perfil == 'DISCENTE'}"
                                 rendered="#{requerimentoBean.tipoBusca == 'DISCENTE'}"
                                 value="#{requerimentoBean.termoBuscaDiscente}" />
                    <p:watermark for="requerimentoBuscaDiscente" value="#{msg.discente}" />
                    <!-- ao pressionar <return>, o formulario submete o commandButton[id=requerimentoBuscaCommand] -->
                    <p:commandButton style="visibility: hidden;" id="requerimentoBuscaCommand"  styleClass="searchCommand floatRight" update="tableRequerimentos :formHeader:systemMessages" />
                    <p:defaultCommand target="requerimentoBuscaCommand" />
                </h:panelGroup>
            </h:panelGroup>
            <p:dataTable id="tableRequerimentos" var="requerimentoItem"
                         value="#{requerimentoBean.requerimentosDataModel}"
                         lazy="true"
                         emptyMessage="#{msg.emptyMessage}"
                         paginator="true"
                         selectionMode="single"
                         selection="#{requerimentoBean.itemSelecionado}"
                         paginatorPosition="bottom"
                         rows="10" pageLinks="5">
                <p:ajax event="rowSelect" update=":requerimentoForm:requerimentoToolbar" listener="#{requerimentoBean.selecionaItem}" />
                <p:column headerText="#{msg.requerimento}" styleClass="requerimentoColA">
                    <h:outputText value="#{requerimentoItem.tipoRequerimento.tipoLocale}" />
                </p:column>
                <p:column headerText="#{msg.status}" sortBy="status" styleClass="requerimentoColB">
                    <h:outputText value="#{requerimentoItem.status.statusLocale}" />
                </p:column>
                <p:column headerText="#{msg.dataCriacao}" sortBy="dataCriacao" styleClass="requerimentoColC">
                    <h:outputText value="#{requerimentoItem.dataCriacao}">
                        <f:convertDateTime locale="#{localeBean.locale}" />
                    </h:outputText>
                </p:column>
                <p:column headerText="#{msg.dataModificacao}" sortBy="dataModificacao" styleClass="requerimentoColD">
                    <h:outputText value="#{requerimentoItem.dataModificacao}">
                        <f:convertDateTime locale="#{localeBean.locale}" />
                    </h:outputText>
                </p:column>
            </p:dataTable>
        </h:form>
    </ui:define>
</ui:composition>
